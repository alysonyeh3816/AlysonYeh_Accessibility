<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>充足時間（對話框版）</title>
  <style>
    :root{
      --bg:#0b1220; --panel:#0f172a; --ink:#e5e7eb; --muted:#94a3b8;
      --brand:#22d3ee; --brand-2:#6366f1; --accent:#10b981; --line:#1f2937;
      --radius:16px; 
      --focus-inner:#60a5fa; --focus-outer:#ffffff;
      --focus: var(--focus-inner);
    }

    *{box-sizing:border-box}
    html,body{margin:0;height:100%}
    body{
      min-height:100%; color:var(--ink);
      font:16px/1.65 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC","PingFang TC",sans-serif;
      background:var(--bg); -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }

    a:focus-visible,
    button:focus-visible,
    [tabindex]:focus-visible {
      outline:3px solid var(--focus-inner);
      outline-offset:2px;
      box-shadow:0 0 0 6px var(--focus-outer);
      border-radius:12px;
    }

    #finishBtn:hover,
    #extendBtn:hover {
      outline:3px solid var(--focus-inner);
      outline-offset:2px;
      box-shadow:0 0 0 6px var(--focus-outer);
      border-radius:12px;
    }

    .skip-link {
      position: absolute;
      left: 12px;
      top: 0;
      transform: translateY(-150%);
      padding: 12px 16px;
      background: #022e2e;
      border: 2px solid var(--brand);
      border-radius: var(--radius);
      text-decoration: none;
      color: var(--ink);
      font-weight: 600;
      z-index: 1000;
    }
    .skip-link:focus,
    .skip-link:focus-visible {
      transform: translateY(10px);
    }

    .hero{
      position:relative; min-height:100dvh; display:grid; place-items:center; text-align:center;
      background:
        radial-gradient(1200px 520px at 10% 10%, rgba(34,211,238,.18), transparent 60%),
        radial-gradient(1000px 520px at 90% 25%, rgba(99,102,241,.20), transparent 60%), var(--panel);
      background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 600'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop offset='0' stop-color='%23ffffff' stop-opacity='0.08'/><stop offset='1' stop-color='%23ffffff' stop-opacity='0.02'/></linearGradient></defs><rect width='800' height='600' fill='none'/><g stroke='%23ffffff' stroke-opacity='0.05' stroke-width='1'><path d='M0 50H800M0 100H800M0 150H800M0 200H800M0 250H800M0 300H800M0 350H800M0 400H800M0 450H800M0 500H800M0 550H800'/><path d='M50 0V600M100 0V600M150 0V600M200 0V600M250 0V600M300 0V600M350 0V600M400 0V600M450 0V600M500 0V600M550 0V600M600 0V600M650 0V600M700 0V600M750 0V600'/></g><g stroke='url(%23g)' stroke-width='2' fill='none'><path d='M80 120 C140 80, 200 160, 260 120 S 380 80, 440 120 S 560 160, 640 120'/><path d='M120 420 C200 380, 260 460, 340 420 S 460 380, 540 420 S 620 460, 700 420'/></g><g fill='%2322d3ee' fill-opacity='0.25'><circle cx='120' cy='120' r='4'/><circle cx='260' cy='120' r='4'/><circle cx='440' cy='120' r='4'/><circle cx='640' cy='120' r='4'/><circle cx='200' cy='420' r='4'/><circle cx='340' cy='420' r='4'/><circle cx='540' cy='420' r='4'/><circle cx='700' cy='420' r='4'/></g></svg>");
      background-size:cover; background-blend-mode:screen;
    }
    .hero-inner{width:min(1100px,92vw); margin-inline:auto; display:grid; gap:18px; justify-items:center; padding:24px 16px}
    .hero h1{margin:0; font-size:clamp(24px,4.6vw,40px)}
    .hero p.sub{margin:0; color:var(--muted); max-width:72ch}

    .link-wire{--wire:#fff; margin-top:10px; color:#fff; border:2px solid var(--wire); border-radius:999px; padding:14px 26px; text-decoration:none; display:inline-flex; align-items:center; justify-content:center; gap:10px; font-weight:800; letter-spacing:.4px; background:transparent; position:relative; overflow:hidden}
    .link-wire::before{content:""; position:absolute; inset:0; background:linear-gradient(90deg,transparent,rgba(255,255,255,.14),transparent); transform:translateX(-100%)}
    .link-wire:hover::before{animation:sweep 1.1s ease-out}
    .link-wire:hover{box-shadow:inset 0 0 0 999px rgba(255,255,255,.035)}
    @keyframes sweep{to{transform:translateX(100%)}}

    .reopen{position:fixed; left:14px; bottom:14px; z-index:50; opacity:.92}
    .reopen .ghost{background:rgba(255,255,255,.06); color:#e8f3ff; border:1px solid #2a335a; border-radius:12px; padding:10px 12px; display:inline-flex; gap:8px; align-items:center; font-weight:700; text-decoration:none; cursor:pointer}
    .reopen .ghost:hover{background:rgba(255,255,255,.1)}

    .backdrop{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(11,18,32,.5); z-index:100; backdrop-filter:saturate(120%) blur(2px)}
    .backdrop[aria-hidden="false"]{display:flex}

    .dialog{
      position:relative; background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04)), rgba(15,23,42,.72);
      color:var(--ink); border:1px solid rgba(148,163,184,.25); border-radius:var(--radius);
      width:min(920px,92vw); padding:clamp(16px,2.6vw,24px);
      box-shadow:0 20px 60px rgba(0,0,0,.55), 0 0 0 1px rgba(99,102,241,.15) inset; backdrop-filter:blur(6px) saturate(120%);
    }
    .dialog h2{margin:4px 0 6px; font-size:clamp(20px,3.2vw,28px)}
    .dialog p.meta{color:var(--muted); margin:0 0 10px}

    .features{display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-top:10px}
    @media (max-width:820px){.features{grid-template-columns:1fr}}
    .feature{display:grid; grid-template-columns:auto 1fr; gap:12px; align-items:flex-start; background:linear-gradient(180deg, rgba(34,211,238,.10), rgba(99,102,241,.06)); border:1px solid rgba(148,163,184,.2); border-radius:14px; padding:12px}
    .icon{width:64px; height:64px; border-radius:14px; display:grid; place-items:center; background:linear-gradient(180deg, rgba(34,211,238,.22), rgba(34,211,238,.08)); border:1px solid #2a335a}
    .icon svg{width:40px; height:40px; display:block}
    .feat-title{margin:.2rem 0 .1rem; font-weight:800}
    .feat-desc{margin:.1rem 0; color:var(--muted)}

    .controls{margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:center}
    .badge{border:1px solid var(--line); border-radius:999px; padding:6px 12px; background:#0b1324; color:#e2e8f0; font-variant-numeric:tabular-nums}
    .btn{border:1px solid var(--line); border-radius:12px; padding:10px 14px; min-height:44px; min-width:44px; cursor:pointer; background:linear-gradient(180deg, rgba(34,211,238,.18), rgba(34,211,238,.08)); color:#e6fbff; font-weight:800; letter-spacing:.2px}
    .btn.secondary{background:linear-gradient(180deg, rgba(99,102,241,.22), rgba(99,102,241,.08)); color:#eef2ff; border-color:#2a335a}

    .timer-controls{position:absolute; top:16px; right:16px; display:flex; align-items:center; gap:10px}

    .sr-only{
      position:absolute !important; clip:rect(1px,1px,1px,1px); clip-path:inset(50%); width:1px; height:1px; margin:-1px; overflow:hidden; border:0; padding:0; white-space:nowrap;
    }

    @media (prefers-reduced-motion:no-preference){
      .fade-in{animation:fade .28s ease-out}
      @keyframes fade{from{opacity:0; transform:translateY(4px)} to{opacity:1; transform:none}}
    }
  </style>
</head>
<body>
  <a href="#heroTitle" class="skip-link">跳到主要內容區</a>

  <main class="hero" aria-label="產品新功能形象頁" id="hero" inert aria-hidden="true">
    <div class="hero-inner">
      <h1 id="heroTitle" tabindex="-1">形象頁範例-非真實網站</h1>
      <p class="sub">AI 智慧客服即時協助；動態統計提供即時趨勢與指標。中央可進入首頁；左下角可再次查看詳細說明。</p>
      <a class="link-wire" href="#" aria-label="進入首頁（示意連結，本身無功能）">
        進入首頁
        <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M5 12h14M13 5l7 7-7 7" fill="none" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </a>
    </div>
    <div class="reopen">
      <button id="openDialog" class="ghost" aria-describedby="reopenHint">
        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 5v14M5 12h14" fill="none" stroke="#e6fbff" stroke-width="2" stroke-linecap="round"/>
        </svg>
        重新看說明
      </button>
      <span id="reopenHint" class="sr-only">開啟新功能詳細說明對話框。</span>
    </div>
  </main>

  <p id="live" class="sr-only" role="status" aria-atomic="true"></p>

  <div id="backdrop" class="backdrop" aria-hidden="true">
    <section id="dialog" class="dialog fade-in"
      role="dialog" aria-modal="true"
      aria-labelledby="dlg-title" aria-describedby="dlg-desc"
      tabindex="-1">
      <div class="timer-controls">
        <span id="initialTimeAnnounce" class="sr-only">共有 60 秒閱讀時間。</span>
        <span class="label" id="timeLabel" aria-hidden="true">剩餘時間：</span>
        <output id="timeLeft" class="badge" aria-hidden="true">—:—</output>
      </div>
      <h2 id="dlg-title">新功能說明<span class="sr-only">對話框</span></h2>
      <p id="dlg-desc" class="meta">
        此說明設有倒數計時。當剩餘時間低於 30 秒時，可按空白鍵或移動/滾動滑鼠延長時間；也可按「延長 60 秒」按鈕。逾時未延長將自動關閉。
      </p>

      <div class="features">
        <article class="feature">
          <div class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <defs><linearGradient id="i1" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#22d3ee"/><stop offset="1" stop-color="#6366f1"/></linearGradient></defs>
              <rect x="3" y="5" width="18" height="12" rx="6" fill="url(#i1)"/>
              <circle cx="9" cy="11" r="1.8" fill="#0b1324"/><circle cx="15" cy="11" r="1.8" fill="#0b1324"/>
              <path d="M7 16c2.5 2 7.5 2 10 0" stroke="#0b1324" stroke-width="1.6" fill="none" stroke-linecap="round"/>
            </svg>
          </div>
          <div>
            <h3 class="feat-title">智慧客服（AI Assistant）</h3>
            <p class="feat-desc">即時回答常見問題、導引操作流程。</p>
          </div>
        </article>

        <article class="feature">
          <div class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <defs><linearGradient id="i2" x1="0" y1="1" x2="1" y2="0"><stop offset="0" stop-color="#10b981"/><stop offset="1" stop-color="#22d3ee"/></linearGradient></defs>
              <rect x="3" y="4" width="18" height="14" rx="2" fill="#0b1324" stroke="#2a335a"/>
              <path d="M5 15l3-3 3 2 4-5 4 3" fill="none" stroke="url(#i2)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <g fill="#22d3ee"><circle cx="8" cy="12" r="1"/><circle cx="11" cy="14" r="1"/><circle cx="15" cy="9" r="1"/><circle cx="19" cy="12" r="1"/></g>
            </svg>
          </div>
          <div>
            <h3 class="feat-title">動態統計（Live Analytics）</h3>
            <p class="feat-desc">即時指標、趨勢圖與報表匯出。</p>
          </div>
        </article>
      </div>

      <div class="controls">
        <button id="finishBtn" class="btn secondary">我已閱讀</button>
        <button id="extendBtn" class="btn">延長 60秒</button>
      </div>
    </section>
  </div>

  <script>
    (function () {
      const skip = document.querySelector('.skip-link');
      if (skip) {
        skip.addEventListener('click', function () {
          const target = document.getElementById('heroTitle');
          if (!target) return;
          if (!target.hasAttribute('tabindex')) target.setAttribute('tabindex', '-1');
          target.focus({ preventScroll: false });
        });
      }

      const BASE_DURATION = 75;   
      const EXTEND_BY = 60;       
      let DURATION = BASE_DURATION;

      const live = document.getElementById('live');
      const backdrop = document.getElementById('backdrop');
      const dialog = document.getElementById('dialog');
      const openBtn = document.getElementById('openDialog');
      const timeOut = document.getElementById('timeLeft');
      const extendBtn = document.getElementById('extendBtn');
      const finishBtn = document.getElementById('finishBtn');
      const heroTitle = document.getElementById('heroTitle');
      const hero = document.getElementById('hero');
      const initialTimeAnnounce = document.getElementById('initialTimeAnnounce');
      const dlgDesc = document.getElementById('dlg-desc'); 

      function syncExtendByLabel(){
        if (extendBtn) {
          extendBtn.textContent = `延長 ${EXTEND_BY}秒`;
        }
        if (dlgDesc) {
          dlgDesc.textContent = dlgDesc.textContent.replace(/延長\s*\d+\s*秒/g, `延長 ${EXTEND_BY} 秒`);
        }
      }
      syncExtendByLabel();

      let remaining = DURATION, ticking = null, startTime = null;
      let autoExtendWindow = false;   
      let isListening = false;        
      let canWindowExtend = false;    
      let lastAnnounced = Infinity;   

      function fmt(sec){ const m = Math.floor(sec/60), s = (sec%60).toString().padStart(2,'0'); return `${m}:${s}`; }
      function render(){ timeOut.textContent = fmt(remaining); }

      function speak(msg){
        live.textContent = '';
        setTimeout(()=>{ live.textContent = msg; }, 20);
      }

      function trapFocus(e){
        if (e.key !== 'Tab') return;
        const f = dialog.querySelectorAll('a[href],button:not([disabled]),[tabindex]:not([tabindex="-1"]),input,select,textarea');
        if (!f.length) return;
        const first = f[0], last = f[f.length-1];
        if (e.shiftKey && document.activeElement===first){ last.focus(); e.preventDefault(); }
        else if (!e.shiftKey && document.activeElement===last){ first.focus(); e.preventDefault(); }
      }

      function setMainInert(on){
        if (!hero) return;
        if (on){ hero.setAttribute('aria-hidden','true'); hero.setAttribute('inert',''); }
        else { hero.removeAttribute('aria-hidden'); hero.removeAttribute('inert'); }
      }

      function setSkipLinkDisabled(disabled){
        if (!skip) return;
        if (disabled){
          skip.setAttribute('aria-hidden','true');
          skip.setAttribute('tabindex','-1');
          skip.setAttribute('inert','');
        } else {
          skip.removeAttribute('aria-hidden');
          skip.removeAttribute('inert');
          skip.removeAttribute('tabindex');
        }
      }

      function extendTime(){ extendBtn.click(); }

      const handleMouseMove = (e)=>{
        if(!canWindowExtend) return;
        if (Math.abs(e.movementX)>20 || Math.abs(e.movementY)>20){ canWindowExtend = false; extendTime(); }
      };
      const handleWheel = (e)=>{
        if(!canWindowExtend) return;
        if (Math.abs(e.deltaY)>0 || Math.abs(e.deltaX)>0){ canWindowExtend = false; extendTime(); }
      };

      function onDocKeyDown(e){
        if(!autoExtendWindow || !canWindowExtend) return;
        const isSpace = (e.code==='Space' || e.key===' ' || e.key==='Spacebar');
        if(!isSpace) return;

        const t = e.target;
        if (t === extendBtn || t === finishBtn) return;

        const tag = t && t.tagName ? t.tagName.toLowerCase() : '';
        if (tag === 'input' || tag === 'textarea' || (t && t.isContentEditable)) return;

        canWindowExtend = false;
        extendTime();
      }

      function addAutoExtendListeners(){
        if (isListening) return;
        document.addEventListener('mousemove', handleMouseMove);
        document.addEventListener('wheel', handleWheel, { passive:true });
        document.addEventListener('keydown', onDocKeyDown, false);
        isListening = true;
      }
      function removeAutoExtendListeners(){
        if (!isListening) return;
        document.removeEventListener('mousemove', handleMouseMove);
        document.removeEventListener('wheel', handleWheel, { passive:true });
        document.removeEventListener('keydown', onDocKeyDown, false);
        isListening = false;
      }

      function announceThresholds(sec){
        if (sec===30 || sec===20 || sec===10 || (sec<=5 && sec>=1)){
          if (sec !== lastAnnounced){
            speak(`剩餘 ${sec} 秒。`);
            lastAnnounced = sec;
          }
        }
      }

      function openDialog(){
        DURATION = BASE_DURATION;
        remaining = DURATION;
        startTime = Date.now();

        if (initialTimeAnnounce) initialTimeAnnounce.textContent = `共有 ${DURATION} 秒閱讀時間。`;

        syncExtendByLabel();

        setMainInert(true);
        setSkipLinkDisabled(true);
        backdrop.setAttribute('aria-hidden','false');
        dialog.addEventListener('keydown', trapFocus);

        autoExtendWindow = false;
        canWindowExtend = false;
        lastAnnounced = Infinity;
        removeAutoExtendListeners();
        render();

        requestAnimationFrame(()=>{ dialog.focus(); });
        setTimeout(()=>{ if (document.activeElement !== dialog) dialog.focus(); }, 0);

        if (ticking) clearInterval(ticking);
        ticking = setInterval(()=>{
          const elapsed = Math.floor((Date.now()-startTime)/1000);
          const currentRemaining = DURATION - elapsed;

          if (currentRemaining > 0){
            remaining = currentRemaining;
            render();

            announceThresholds(remaining);

            if (remaining <= 30){
              if (!autoExtendWindow){
                autoExtendWindow = true;
                canWindowExtend = true;      
                addAutoExtendListeners();
              }
            } else if (autoExtendWindow){
              autoExtendWindow = false;
              canWindowExtend = false;
              removeAutoExtendListeners();
            }
          } else {
            remaining = 0;
            render();
            speak('時間到，說明已自動關閉。');  
            clearInterval(ticking); ticking=null;
            autoExtendWindow = false; canWindowExtend = false;
            removeAutoExtendListeners();
            closeDialog('timeout_nospeak');
          }
        }, 1000);
      }

      function closeDialog(reason){
        if (ticking){ clearInterval(ticking); ticking=null; }
        backdrop.setAttribute('aria-hidden','true');
        dialog.removeEventListener('keydown', trapFocus);
        setMainInert(false);
        setSkipLinkDisabled(false);
        autoExtendWindow = false; canWindowExtend = false;
        removeAutoExtendListeners();
        if (heroTitle){ heroTitle.focus(); }
      }

      extendBtn.addEventListener('click', ()=>{
        DURATION += EXTEND_BY;
        remaining = DURATION - Math.floor((Date.now()-startTime)/1000);
        lastAnnounced = Infinity;  
        render();
        speak(`已延長 ${EXTEND_BY} 秒。當前剩餘 ${remaining} 秒後將關閉對話框。`);
      });

      finishBtn.addEventListener('click', ()=> closeDialog('finish'));
      if (openBtn) openBtn.addEventListener('click', openDialog);

      document.addEventListener('keydown', (e)=>{
        if (backdrop.getAttribute('aria-hidden')==='false' && e.key==='Escape'){
          closeDialog('finish');
        }
      });

      openDialog();
    })();
  </script>
</body>
</html>
