<!DOCTYPE html>
<html lang="zh-hant-TW">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>無障礙元件展示</title>
    <link rel="stylesheet" href="../css/accordion.css">
    <script src="../js/accordion.js" defer></script>
    <style>
        :root {
            --blue: #005fcc;
            --focus: var(--a-blue)
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :focus-visible {
            outline: 3px solid var(--focus);
            outline-offset: 2px;
            box-shadow: 0 0 0 3px #fff;
        }

        .visually-hidden {
            clip: rect(1px, 1px, 1px, 1px);
            clip-path: inset(50%);
            height: 1px;
            width: 1px;
            margin: -1px;
            overflow: hidden;
            padding: 0;
            position: absolute;
        }

        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans TC", sans-serif;
            padding: 20px;
            background: #fff;
            color: #111;
        }

        .skip-link {
            position: absolute;
            left: 12px;
            top: 0;
            transform: translateY(-150%);
            padding: 12px 16px;
            color: #252525;
            background: #fff;
            border: 2px solid var(--blue);
            text-decoration: none;
            font-weight: 600;
            z-index: 1000;
        }

        .skip-link:focus,
        .skip-link:focus-visible {
            transform: translateY(12px);
            outline: 0;
        }

        h1 {
            text-align: center;
            margin-top: 20px;
        }

        .carousel_section {
            max-width: 1200px;
            margin: 40px auto;
            aspect-ratio: 16/5;
            background: #cecece;
            position: relative;
        }

        .shell {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        #togglePlay {
            margin: 10px auto;
            display: block;
            background: var(--blue);
            color: #fff;
            border: none;
            padding: 6px 12px;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
        }

        .carousel_region {
            width: 100%;
            aspect-ratio: 16/5;
            background: #ebebeb;
            position: relative;
            overflow: hidden;
            outline: 0;
        }

        .carouselBtn_outer {
            position: absolute;
            top: 5%;
            left: 50%;
            transform: translate(-50%, 0);
            z-index: 10000;
        }

        .carousel {
            width: 100%;
            height: 100%;
        }

        .pic_big {
            position: relative;
            height: 100%;
        }

        .pic_big li {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            z-index: 0;
            transition: opacity .5s ease;
        }

        .pic_big li[id="now"] {
            opacity: 1;
            z-index: 1;
        }

        .pic_big li img {
            width: 100%;
            height: auto;
            aspect-ratio: 16/5;
            object-fit: cover;
        }

        .btn_next,
        .btn_pre {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 60px;
            height: 60px;
            background: rgba(0, 0, 0, .5);
            border: none;
            z-index: 10;
            cursor: pointer;
        }

        .btn_next:hover,
        .btn_pre:hover {
            background: rgba(46, 87, 223, .5);
        }

        .btn_pre {
            left: 10px;
        }

        .btn_next {
            right: 10px;
        }

        .btn_next::before,
        .btn_pre::before {
            content: "";
            display: inline-block;
            width: 0;
            height: 0;
            border-style: solid;
        }

        .btn_pre::before {
            border-width: 15px 20px 15px 0;
            border-color: transparent #fff transparent transparent;
        }

        .btn_next::before {
            border-width: 15px 0 15px 20px;
            border-color: transparent transparent transparent #fff;
        }

        .carousel_1_tab_box {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
        }

        .carousel_1_tab {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .carousel_1_tab button {
            background: 0 0;
            border: none;
            padding: 0;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .carousel_1_tab button:focus-visible{
            border-radius: 30%;
    
        }

        .carousel_1_tab svg circle {
            fill: #c4c4c4;
        }

        .carousel_1_tab button.active svg circle {
            fill: var(--blue);
        }
    </style>

</head>

<body>

    <body>
        <a href="#mainh1" class="skip-link">跳到主要內容區</a>
        <div class="top-link">
            <a href="#auditCode" aria-label="移至相應稽核評量碼">移至相應稽核評量碼</a>
            <a href="#detectionItem" aria-label="移至檢測方式">移至檢測方式</a>
        </div>

        <main>
            <h1 id="mainh1">輪播-純圖片：使用左右按鈕、指示圈切換輪播圖</h1>

            <div class="carousel_section">
                <div class="shell" tabindex="0" aria-label="第一種輪播圖區塊" role="region"></div>

                <div class="carouselBtn_outer">
                    <button id="togglePlay" aria-pressed="true" aria-label="啟動輪播">播放中</button>
                </div>

                <div id="carousel_1kind" class="carousel_region">
                    <div class="carousel">

                        <button class="btn_pre" aria-label="前一張"></button>
                        <button class="btn_next" aria-label="下一張"></button>

                        <ul class="pic_big" aria-live="off">
                            <li><img aria-hidden="false" src="../images/carousel_1.jpg" alt="圖片1 雲層內的光" /></li>
                            <li><img aria-hidden="true" src="../images/carousel_2.jpg" alt="圖片2 秋天高山雲海" /></li>
                            <li><img aria-hidden="true" src="../images/carousel_3.jpg" alt="圖片3 櫻花近拍" /></li>
                        </ul>

                        <div class="carousel_1_tab_box">
                            <div class="carousel_1_tab">
                                <button aria-label="項目一"><svg>
                                        <circle cx="9" cy="9" r="8" stroke="#555" stroke-width="2" />
                                    </svg></button>
                                <button aria-label="項目二"><svg>
                                        <circle cx="9" cy="9" r="8" stroke="#555" stroke-width="2" />
                                    </svg></button>
                                <button aria-label="項目三"><svg>
                                        <circle cx="9" cy="9" r="8" stroke="#555" stroke-width="2" />
                                    </svg></button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div id="live-region" class="visually-hidden" role="status" aria-live="off"></div>

            <h2 id="auditCode">相應稽核評量碼</h2>
            <div id="accordionContainer"></div>

            <a id="quickLink" href="#mainh1" aria-label="移至待檢測元件">移至待檢測元件</a>

            <h2 id="detectionItem">檢測方式</h2>
            <div class="test-guide-container">
                <h3>檢測項目：純資訊輪播或跑馬燈</h3>
                <ol>
                    <li>
                        <p>確認輪播/跑馬燈組件是否會動，若不會動則進入(5)。</p>
                    </li>
                    <li>
                        <p>若輪播／跑馬燈組件具有自動播放或自動移動效果，則：</p>
                        <ul>
                            <li>應確認組件中提供暫停按鈕（或刪除/隱藏按鈕，下同，統稱為「暫停/中止/隱藏元件」）。</li>
                            <li>該暫停/中止/隱藏元件應為整個輪播/跑馬燈組件中第一個可聚焦元件。</li>
                            <li>若第一個可聚焦元件為整個輪播/跑馬燈組件本身，則暫停/中止/隱藏元件可作為第二個可聚焦元件（見註一）。</li>
                        </ul>
                    </li>
                    <li>
                        <p>確認鍵盤可操作「暫停/中止/隱藏元件」，並且功能與之相符。</p>
                    </li>
                    <li>
                        <p>若輪播組件提供暫停機制，則以下須擇一達成：</p>
                        <ul>
                            <li><strong>類型一</strong>、同時提供暫停、播放按鈕，須確認暫停與播放按鈕均可操作。</li>
                            <li><strong>類型二</strong>、僅提供暫停按鈕，則確認暫停按鈕本身具切換功能，可進行暫停及播放功能。</li>
                        </ul>
                    </li>
                    <li>
                        <p>以滑鼠確認各輪播圖/跑馬燈是否無功能(功能常見如連結)。</p>
                    </li>
                    <li>
                        <p>確認無功能後，以tab鍵遊走輪播圖/跑馬燈組件各元件，確認焦點跳位順序符合邏輯。</p>
                    </li>
                    <li>
                        <p>確認各元件可操作（類型一或類型二，擇一即可）：</p>
                        <ul>
                            <li><strong>類型一</strong>、若鍵盤焦點(tab鍵)無法走入輪播圖片/跑馬燈各項目，則以tab鍵遊走入向前、向後鍵或指示標籤後，應達成以下A、B、C方式任一種操作：
                                <ul>
                                    <li><strong>A方式</strong>：若輪播圖/跑馬燈各項目以向前、向後鍵進行切換，則需符合以下要求：
                                        <ul>
                                            <li>若輪播圖/跑馬燈各項目以「向前」或「向後」進行切換，則當鍵盤焦點至其上時，應報讀按鈕名稱（如：「向前」、「向後」、「上一張」、「下一張」等同義標籤皆可）。
                                            </li>
                                            <li>當按下上述切換按鈕時，被選中之輪播圖片/跑馬燈項目應可視。</li>
                                            <li>螢幕報讀器應主動報讀被選取之輪播圖片/跑馬燈項目內容。</li>
                                        </ul>
                                    </li>
                                    <li><strong>B方式</strong>：若輪播圖／跑馬燈項目以指示標籤進行切換，則需符合以下要求：
                                        <ul>
                                            <li>當鍵盤焦點停留於指示標籤時，螢幕報讀器應朗讀該項目的項目值（例如：「項目一」、「項目二」等）或其他等效描述。</li>
                                            <li>當某項目被選取後，該項目應在視覺上清晰可見。</li>
                                            <li>螢幕報讀器應完整報讀被選取項目的內容（例如替代文字、標題、描述等）。</li>
                                        </ul>
                                    </li>
                                    <li><strong>C方式</strong>：若輪播圖/跑馬燈個項目以指示標籤進行切換，則需符合以下要求：
                                        <ul>
                                            <li>當鍵盤焦點（Tab 鍵）停留於指示標籤時，螢幕報讀器應直接報讀該輪播圖片／跑馬燈項目的名稱。</li>
                                            <li>當項目被選取後，該項目應在視覺上清晰可見。</li>
                                            <li>螢幕報讀軟體應主動報讀相應提示，如：已按下、已選取。</li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li><strong>類型二</strong>、若鍵盤焦點(tab鍵)可游走輪播圖片/跑馬燈各項目，則該項目被鍵盤焦點(tab鍵)遊走時，應主動報讀出該項目內容。</li>
                        </ul>
                    </li>
                    <li>
                        <p>承前項(7)，鍵盤可操作類型一或類型二（不考量報讀）。</p>
                    </li>
                    <li>
                        <p>承項目(7)，若選擇類型二，則檢查當鍵盤焦點(tab鍵)停駐在圖片輪播圖片/跑馬燈項目，該圖片/跑馬燈項目會暫停，此時可清楚看見鍵盤焦點指示符。</p>
                    </li>
                    <li>
                        <p>再次按鍵盤焦點(tab鍵)，鍵盤焦點(tab鍵)可移動並選取下一項。</p>
                    </li>
                    <li>
                        <p>鍵盤焦點(tab鍵)取到各可聚焦元素時，確認在不同瀏覽器中，鍵盤焦點（tab鍵）皆呈現瀏覽器預設的指示樣式或由網頁作者指定的明確可見變化的視覺樣式。</p>
                    </li>
                    <li>
                        <p>檢查焦點指示器的區域至少有 1 CSS像素圍繞該元素，檢查指示器在聚焦與未聚焦狀態之間對比度的改變，指示器的區域是否具有 3:1對比值。</p>
                    </li>
                    <li>
                        <p>確認輪播圖、跑馬燈各元件之名稱及角色與其功能相符。</p>
                    </li>
                    <li>
                        <p>確認以鍵盤tab鍵及shift+tab鍵可遊走輪播/跑馬燈組件時，最終可順利離開整組組件。</p>
                    </li>
                    <li>
                        <p>以上均符合則全數通過。</p>
                    </li>
                </ol>
                <p style="margin: 20px 0 10px 0;">
                    <strong>註一：</strong>若第一個鍵盤焦點是整組輪播，並且能報讀整組件為輪播，則暫停、中止或直接在視覺且無障礙均隱藏的機制（如暫停鈕、隱藏鈕、移除鈕），可以為第二個焦點。
                </p>
                <p><strong>註一的白話文說明：</strong>有些程式會用一個大標籤包裹整個輪播或跑馬燈，然後讓那個大標籤可聚焦並報讀「輪播圖」。這樣就會導致暫停鈕、隱藏鈕、移除鈕會是輪播組件第二個可聚焦的元件。
                </p>
            </div>

            <a href="../index.html" class="back-to-catalog">回到目錄</a>
        </main>

        <script>
            var skip = document.querySelector('.skip-link');
            if (skip) {
                skip.addEventListener('click', function () {
                    var target = document.getElementById('mainh1');
                    if (!target) return;
                    if (!target.hasAttribute('tabindex')) target.setAttribute('tabindex', '-1');
                    target.focus({
                        preventScroll: false
                    });
                });
            }


            const accordionData = [{
                title: "指引1.4：可辨識",
                content: `
                    <p><strong>CS1140101E</strong> 當使用者介面元件取得焦點時，使用CSS變更其呈現方式</p>
                    <p>⇒ 檢測方式(1)、(4)、(6)、(7)、(8)、(9)、(10)、(11)通過，則此項通過</p>
                    <p><strong>GN2141100E</strong> 使用網頁作者設定的高可視焦點指示器</p>
                    <p>⇒ 檢測方式(1)、(4)、(6)、(7)、(8)、(9)、(10)、(11)、(12)通過，則此項通過</p>
                `
            }, {
                title: "指引2.1：鍵盤可操作",
                content: `
                    <p><strong>GN1210101E</strong> 確認所有功能都能透過鍵盤介面來操作</p>
                    <p>⇒ 檢測方式(2)、(3)、(4)、(5)、(7)、(8)、(9)全部通過，則此項通過</p>
                    <p><strong>GN1210200E</strong> 確認使用者不會困在內容中</p>
                    <p>⇒ 檢測方式(2)、(3)、(4)、(5)、(7)、(8)、(9)、(10)、(14)全部通過，則此項通過</p>
                `
            }, {
                title: "指引2.2：充足時間",
                content: `
                    <p><strong>GN1220200E</strong> 讓內容能加以暫停，並可從暫停處重新開始</p>
                    <p>⇒ 檢測方式(1)、(2)、(3)、(4)通過，則此項通過</p>
                    <p><strong>GN1220202E</strong> 在網頁內使用可以停止移動、閃動、自動更新等內容的控制元件</p>
                    <p>⇒ 檢測方式(1)、(2)、(3)通過，則此項通過</p>
                `
            }, {
                title: "指引2.4：可導覽",
                content: `
                    <p><strong>GN1240300E</strong> 按照內容的序列及關連性來安排互動元件的放置順序</p>
                    <p>⇒ 檢測方式(1)、(2)、(5)、(6)通過，則此項通過</p>
                `
            }, {
                title: "指引4.1：相容性",
                content: `
                    <p><strong>GN1410200E</strong> 使用者介面元件應暴露名稱與角色，允許直接設定可由使用者設定的屬性，並在變更時提供通知</p>
                    <p>⇒ 檢測方式(7)、(13)通過，則此項通過</p>
                `
            },];

            const carousel = document.getElementById('carousel_1kind');
            const liveRegionContainer = document.getElementById('live-region');
            const slides = carousel.querySelectorAll('.pic_big li');
            const prevBtn = carousel.querySelector('.btn_pre');
            const nextBtn = carousel.querySelector('.btn_next');
            const dots = carousel.querySelectorAll('.carousel_1_tab button');
            const toggleBtn = document.getElementById('togglePlay');

            let currentIndex = 0;
            let interval = null;
            let isPlaying = true;
            let userIntendedToPlay = true;

            function goToSlide(index, isUserAction = false) {
                slides.forEach((slide, i) => {
                    slide.setAttribute('id', i === index ? 'now' : '');
                    slide.querySelector('img').setAttribute('aria-hidden', i === index ? 'false' : 'true');

                });

                dots.forEach((dot, i) => {
                    dot.classList.toggle('active', i === index);
                    dot.setAttribute('aria-pressed', i === index ? 'true' : 'false');
                });

                currentIndex = index;

                if (isUserAction) {
                    liveRegionContainer.setAttribute('aria-live', 'polite');
                    const alt = slides[index].querySelector('img').alt;
                    liveRegionContainer.textContent = `第 ${index + 1} 張，共 ${slides.length} 張：${alt}`;
                }
            }

            function nextSlide() {
                goToSlide((currentIndex + 1) % slides.length);
            }

            function prevSlide() {
                goToSlide((currentIndex - 1 + slides.length) % slides.length);
            }

            function startAutoPlay() {
                if (interval) return;
                interval = setInterval(() => nextSlide(), 3600);
                toggleBtn.textContent = '播放中';
                toggleBtn.setAttribute('aria-pressed', 'true');
                isPlaying = true;
            }

            function stopAutoPlay() {
                clearInterval(interval);
                interval = null;
                toggleBtn.textContent = '暫停中';
                toggleBtn.setAttribute('aria-pressed', 'false');
                isPlaying = false;
            }

            function resetAutoPlay() {
                if (isPlaying) {
                    clearInterval(interval);
                    interval = setInterval(() => nextSlide(), 3600);
                }
            }

            toggleBtn.addEventListener('click', () => {
                userIntendedToPlay = toggleBtn.getAttribute('aria-pressed') !== 'true';
                userIntendedToPlay ? startAutoPlay() : stopAutoPlay();
            });

            prevBtn.addEventListener('click', () => {
                prevSlide();
                goToSlide(currentIndex, true);
                resetAutoPlay();
            });

            nextBtn.addEventListener('click', () => {
                nextSlide();
                goToSlide(currentIndex, true);
                resetAutoPlay();
            });

            dots.forEach((dot, i) => {
                dot.setAttribute('aria-pressed', 'false');
                dot.addEventListener('click', () => {
                    goToSlide(i, true);
                    resetAutoPlay();
                });
            });

            carousel.addEventListener('focusin', () => {
                stopAutoPlay();
            });

            carousel.addEventListener('focusout', () => {
                setTimeout(() => {
                    if (!carousel.contains(document.activeElement)) {
                        if (userIntendedToPlay) {
                            startAutoPlay();
                        } else {
                            stopAutoPlay();
                        }
                        liveRegionContainer.setAttribute('aria-live', 'off');
                        liveRegionContainer.textContent = '';
                    }
                }, 0);
            });

            goToSlide(0);
            startAutoPlay();

            document.addEventListener('DOMContentLoaded', function () {
                if (typeof window.initializeAccordion === 'function') {
                    window.initializeAccordion('accordionContainer', accordionData);
                } else {
                    console.error('initializeAccordion 未載入。請確認 ../js/accordion.js 是否將函式掛到 window。');
                }
            });           
        </script>
    </body>

</html>
